{% extends 'portfoliohut/base.html' %}
{% block head %}
    <title>Profile</title>
{% endblock head %}

{% block content %}
  <div class="container">

    <!-- Page Title -->
    <div class="row mt-4 mb-2">
      <h1 class="text-center">Profile</h1>
      <h2 class="text-center">{{ profile.user.username }}</h2>
    </div>

<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.stock.min.js"></script>
<script type="text/javascript">
    window.onload = function () {
    var dataPoints = [];
    var stockChart = new CanvasJS.StockChart("stockChartContainer", {
      exportEnabled: true,
      title: {
        text:"Portfolio Returns"
      },
      subtitles: [{
        text:""
      }],
      charts: [{
        axisX: {
          crosshair: {
            enabled: true,
            snapToDataPoint: true,
            valueFormatString: "MMM YYYY"
          }
        },
        axisY: {
          title: "Return percentage",
          prefix: "",
          suffix: "%",
          crosshair: {
            enabled: true,
            snapToDataPoint: true,
            valueFormatString: "$#,###.00M",
          }
        },
        data: [{
          type: "line",
          xValueFormatString: "MMM YYYY",
          yValueFormatString: "$#,###.##M",
          dataPoints : dataPoints
        }]
      }],
      
    });
  
  d3.csv("/static/portfoliohut/data/test_transactions.csv", function(data) {
      for (var i = 0; i < data.length; i++) {
          dataPoints.push({x: new Date(data[i].DATE), y: Number(data[i].Returns)});
          console.log(data[i].DATE);
          console.log(data[i].Returns);
      }
      stockChart.render();
  
  });
  }
</script>

 <div id="stockChartContainer" style="height: 400px; width: 100%;"></div>
  </div>
</div>

<!-- TODO: Add Table of transactions -- staticfiles
TODO: Add portfolio Table  -->
<br>
<br>
<div name = "Profile Table" style= "margin:auto; margin-top:2.5em" >
  <h4>Current Portfolio Summary</h4>

  <table class="table table-hover">
    <thead>
      <tr>
        <th scope="col"></th>
        <th scope="col">Ticker</th>
        <th scope="col">Current Price</th>
        <th scope="col">Value</th>
      </tr>
    </thead>
    <tbody>
      {% for entry in profile_table %}
      <tr>
        <th scope="row">{{ forloop.counter  }}</th>
        <td>{{ entry.0 }}</td>
        <td>{{ entry.1 }}</td>
        <td>{{ entry.2 }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <h4>Total Portfolio Value(USD): {{total}}</h4>



</div>


{% endblock content %}